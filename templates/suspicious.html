{% extends "base.html" %}
{% block content %}

<div class="card-secure p-4">

    <h3 class="mb-4">URL Log Explorer</h3>

    <!-- FILTER BAR -->
    <form method="get" action="/urls" class="row g-2 mb-3">

        <div class="col-lg-3">
            <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Search URL">
        </div>

        <div class="col-lg-2">
            <select name="filter" class="form-select">
                <option value="">All</option>
                <option value="bad" {% if filter_by=='bad' %}selected{% endif %}>Malicious</option>
                <option value="good" {% if filter_by=='good' %}selected{% endif %}>Benign</option>
            </select>
        </div>

        <div class="col-lg-2">
            <select name="sort" class="form-select">
                <option value="ts" {% if sort=='ts' %}selected{% endif %}>Timestamp</option>
                <option value="prediction" {% if sort=='prediction' %}selected{% endif %}>Prediction</option>
                <option value="url" {% if sort=='url' %}selected{% endif %}>URL</option>
            </select>
        </div>

        <div class="col-lg-2">
            <select name="order" class="form-select">
                <option value="desc" {% if order=='desc' %}selected{% endif %}>Descending</option>
                <option value="asc" {% if order=='asc' %}selected{% endif %}>Ascending</option>
            </select>
        </div>

        <div class="col-lg-1">
            <select name="per_page" class="form-select">
                <option value="10" {% if per_page==10 %}selected{% endif %}>10</option>
                <option value="25" {% if per_page==25 %}selected{% endif %}>25</option>
                <option value="50" {% if per_page==50 %}selected{% endif %}>50</option>
                <option value="100" {% if per_page==100 %}selected{% endif %}>100</option>
            </select>
        </div>

        <div class="col-lg-2">
            <button class="btn btn-primary w-100">Apply</button>
        </div>
    </form>

    <!-- META BAR -->
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="text-muted small">
            Showing <strong>{{ total_rows }}</strong> rows Â· Page {{ page }} of {{ total_pages }}
        </div>

        <a class="btn btn-outline-secondary btn-sm"
           href="/download_filtered?q={{ q }}&filter={{ filter_by }}&sort={{ sort }}&order={{ order }}">
           Download CSV
        </a>
    </div>

    <!-- TABLE -->
    <div class="table-container border rounded">
        {{ table_html|safe }}
    </div>

    <!-- PAGINATION -->
    {% if total_pages > 1 %}
    <nav class="mt-4">
        <ul class="pagination justify-content-center mb-0">
            {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link"
                   href="?q={{ q }}&filter={{ filter_by }}&sort={{ sort }}&order={{ order }}&per_page={{ per_page }}&page={{ p }}">
                   {{ p }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </nav>
    {% endif %}

</div>

{% endblock %}
